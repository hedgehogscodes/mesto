(()=>{"use strict";var t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__btn",inactiveButtonClass:"popup__btn_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},e=document.querySelector(".profile__avatar"),n=document.querySelector(".profile__btn_action_edit"),o=document.querySelector(".profile__btn_action_add"),r=".photo-grid__list",i=document.querySelector(".popup_edit"),c=i.querySelector(".popup__edit-form"),a=i.querySelector(".popup__input_type_name"),u=i.querySelector(".popup__input_type_status"),s=i.querySelector(".popup__btn_action_save"),l=document.querySelector(".popup_add").querySelector(".popup__add-form"),p=l.querySelector(".popup__btn_action_create"),f=document.querySelector(".popup_confirm").querySelector(".popup__btn_action_confirm"),h=document.querySelector(".popup_avatar").querySelector(".popup__avatar-from"),_=h.querySelector(".popup__btn_action_save");function d(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var y=function(){function t(e,n){var o=e.data,r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._items=o,this._renderer=r,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"clear",value:function(){this._container.innerHTML=""}},{key:"addItem",value:function(t,e){1==e?this._container.append(t):this._container.prepend(t)}},{key:"renderItems",value:function(){var t=this;this._items.forEach((function(e){t._renderer(e)}))}}])&&d(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var b=function(){function t(e,n,o,r,i,c,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cardTitle=e.name,this._cardLink=e.link,this._templateSelector=n,this._openPopupViewPhotoFunc=o,this.cardId=e._id,this._cardOwnerId=e.owner._id,this._currentUserId=r,this._likes=e.likes,this._deletePhotoCard=i,this._addlikefunc=c,this._dellikefunc=a}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".photo-grid__item").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var t=this;this._likeButton.addEventListener("click",(function(){t._isLiked()?t._dellikefunc():t._addlikefunc()})),this._deleteButton.addEventListener("click",this._deletePhotoCard.bind(this)),this._linkPhotoCard.addEventListener("click",(function(){t._openPopupViewPhotoFunc()}))}},{key:"_isLiked",value:function(){var t=this;return this._likes.some((function(e){return e._id===t._currentUserId}))}},{key:"_renderLikes",value:function(){this._isLiked()?this._likeButton.classList.add("photo-grid__btn_active"):this._likeButton.classList.remove("photo-grid__btn_active"),this._element.querySelector(".photo-grid__like-amount").textContent=this._likes.length}},{key:"updateLikes",value:function(t){this._likes=t,this._renderLikes()}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._element.querySelector(".photo-grid__title").textContent=this._cardTitle,this._linkPhotoCard=this._element.querySelector(".photo-grid__image"),this._linkPhotoCard.src=this._cardLink,this._linkPhotoCard.alt="Фотография:"+this._cardTitle,this._deleteButton=this._element.querySelector(".photo-grid__delete-button"),this._likeButton=this._element.querySelector(".photo-grid__btn_action_like"),this._renderLikes(),this._setEventListeners(),this._cardOwnerId!==this._currentUserId&&this._element.querySelector(".photo-grid__delete-button").remove(),this._element}}])&&v(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function m(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var k=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._classObject=e,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(this._classObject.inputSelector)),this._buttonElement=this._formElement.querySelector(this._classObject.submitButtonSelector)}var e,n;return e=t,(n=[{key:"_showInputError",value:function(t,e){var n=this._formElement.querySelector("#".concat(t.id,"-error"));t.classList.add(this._classObject.inputErrorClass),n.textContent=e,n.classList.add(this._classObject.errorClass)}},{key:"_hideInputError",value:function(t){var e=this._formElement.querySelector("#".concat(t.id,"-error"));t.classList.remove(this._classObject.inputErrorClass),e.classList.remove(this._classObject.errorClass),e.textContent=""}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(t){return!t.validity.valid}))}},{key:"inactivateButton",value:function(){this._buttonElement.classList.add(this._classObject.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}},{key:"activateButton",value:function(){this._buttonElement.classList.remove(this._classObject.inactiveButtonClass),this._buttonElement.removeAttribute("disabled")}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?this.inactivateButton():this.activateButton()}},{key:"_setEventListeners",value:function(){var t=this;this._toggleButtonState(),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t._toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"resetErrors",value:function(){if(0!==this._inputList.length)for(var t=0;t<this._inputList.length;t++)this._hideInputError(this._inputList[t])}}])&&m(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function g(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var w=function(){function t(e){var n=e.nameSelector,o=e.statusSelector,r=e.avatarSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=document.querySelector(n),this._status=document.querySelector(o),this._avatar=document.querySelector(r)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{name:this._name.textContent,status:this._status.textContent}}},{key:"setUserInfo",value:function(t,e,n,o){this._name.textContent=t,this._status.textContent=e,this.id=n,this._avatar.style.backgroundImage="url(".concat(o,")")}}])&&g(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function E(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var O=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=document.querySelector(e),this._page=document.querySelector(".page"),this._handleEscClose=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"_clickOverlayPopup",value:function(t){t.target===t.currentTarget&&this.close()}},{key:"open",value:function(){this._page.classList.add("page_hiddened"),this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._page.classList.remove("page_hiddened"),this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){this._popup.querySelector(".popup__btn_action_close").addEventListener("click",this.close.bind(this)),this._popup.addEventListener("mousedown",this._clickOverlayPopup.bind(this))}}])&&E(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function C(){return C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=j(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},C.apply(this,arguments)}function j(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=I(t)););return t}function P(t,e){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},P(t,e)}function T(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I(t)}var q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&P(t,e)}(c,t);var e,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(o);if(r){var n=I(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return T(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=i.call(this,t))._popupViewImg=e._popup.querySelector(".popup__img"),e._popupImgInfo=e._popup.querySelector(".popup__img-info"),e}return e=c,(n=[{key:"open",value:function(t,e){this._popupViewImg.src=e,this._popupViewImg.alt="Фотография: "+t,this._popupImgInfo.textContent=t,C(I(c.prototype),"open",this).call(this)}}])&&L(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(O);function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function B(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function x(){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=z(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},x.apply(this,arguments)}function z(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=A(t)););return t}function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},V(t,e)}function U(t,e){if(e&&("object"===R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}var D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V(t,e)}(c,t);var e,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(o);if(r){var n=A(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return U(this,t)});function c(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._handleFormSubmit=e,n._popupForm=n._popup.querySelector(".popup__form"),n._inputList=Array.from(n._popupForm.querySelectorAll(".popup__input")),n}return e=c,(n=[{key:"_getInputValues",value:function(){this._inputsValues={};for(var t=0;t<this._inputList.length;t++)this._inputsValues[this._inputList[t].name]=this._inputList[t].value;return this._inputsValues}},{key:"_formSubmit",value:function(t){t.preventDefault(),this._handleFormSubmit(this._getInputValues())}},{key:"setEventListeners",value:function(){this._popupForm.addEventListener("submit",this._formSubmit.bind(this)),x(A(c.prototype),"setEventListeners",this).call(this)}},{key:"close",value:function(){x(A(c.prototype),"close",this).call(this),this._popupForm.reset()}}])&&B(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(O);function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function N(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function H(){return H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=J(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},H.apply(this,arguments)}function J(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=K(t)););return t}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},G(t,e)}function M(t,e){if(e&&("object"===F(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function K(t){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},K(t)}var Q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}(c,t);var e,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=K(o);if(r){var n=K(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return M(this,t)});function c(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._handleSubmit=e,n}return e=c,(n=[{key:"open",value:function(t){H(K(c.prototype),"open",this).call(this),this._card=t}},{key:"setEventListeners",value:function(){this._popup.querySelector(".popup__btn_action_confirm").addEventListener("click",function(t){t.preventDefault(),this._handleSubmit(this._card)}.bind(this)),H(K(c.prototype),"setEventListeners",this).call(this)}}])&&N(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(O);function W(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var X=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._token=e.baseUrl,this._authorization=e.headers.authorization,this._contentType=e.headers["Content-Type"]}var e,n;return e=t,(n=[{key:"_checkResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._token,"/users/me"),{method:"GET",headers:{authorization:this._authorization}}).then(this._checkResponse)}},{key:"getInitialCards",value:function(){return fetch("".concat(this._token,"/cards"),{method:"GET",headers:{authorization:this._authorization}}).then(this._checkResponse)}},{key:"saveUserInfo",value:function(t){var e=t.name,n=t.status;return fetch("".concat(this._token,"/users/me"),{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({name:e,about:n})}).then(this._checkResponse)}},{key:"addCard",value:function(t){var e=t.title,n=t.link;return fetch("".concat(this._token,"/cards"),{method:"POST",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({name:e,link:n})}).then(this._checkResponse)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._token,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"addLike",value:function(t){return fetch("".concat(this._token,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._authorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"deleteLike",value:function(t){return fetch("".concat(this._token,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"editAvatar",value:function(t){return fetch("".concat(this._token,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({avatar:"".concat(t)})}).then(this._checkResponse)}}])&&W(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Y=new k(t,c);Y.enableValidation();var Z=new k(t,l);Z.enableValidation();var $=new k(t,h);$.enableValidation();var tt=new y({data:[]},r),et=new w({nameSelector:".profile__name",statusSelector:".profile__status",avatarSelector:".profile__avatar"}),nt=new X({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-46",headers:{authorization:"52b3031e-4bbf-4230-9679-707716e24a97","Content-Type":"application/json"}}),ot=new q(".popup_photo-view");ot.setEventListeners();var rt=new D(".popup_edit",(function(t){s.textContent="Сохранение...",nt.saveUserInfo(t).then((function(t){st(t),rt.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){s.textContent="Сохранить"}))}));rt.setEventListeners();var it=new D(".popup_add",(function(t){p.textContent="Создание...",nt.addCard(t).then((function(t){ht(ut(t,"#card-template",(function(){ot.open(t.name,t.link)})),tt,!1),l.reset(),it.close(),Z.inactivateButton()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){p.textContent="Создать"}))}));it.setEventListeners();var ct=new D(".popup_avatar",(function(t){_.textContent="Сохранение...",nt.editAvatar(t.link).then((function(t){st(t),ct.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){_.textContent="Сохранить"}))}));ct.setEventListeners();var at=new Q(".popup_confirm",(function(t){f.textContent="Удаление...",nt.deleteCard(t.cardId).then((function(){t._element.remove(),t._element=null,at.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){f.textContent="Да"}))}));function ut(t,e,n){var o=new b(t,e,n,et.id,(function(){at.open(o)}),(function(){nt.addLike(t._id).then((function(t){o.updateLikes(t.likes)})).catch((function(t){return console.log("Error ".concat(t))}))}),(function(){nt.deleteLike(t._id).then((function(t){o.updateLikes(t.likes)})).catch((function(t){return console.log("Error ".concat(t))}))}));return o.generateCard()}function st(t){et.setUserInfo(t.name,t.about,t._id,t.avatar)}function lt(t){Y.resetErrors();var e=et.getUserInfo();a.value=e.name,u.value=e.status,rt.open()}function pt(t){Z.resetErrors(),it.open()}function ft(){$.resetErrors(),ct.open()}function ht(t,e,n){e.addItem(t,n)}at.setEventListeners();var _t=[nt.getUserInfo(),nt.getInitialCards()];Promise.all(_t).then((function(t){var i,c;st(t[0]),i=t[1],(c=new y({data:i,renderer:function(t){ht(ut(t,"#card-template",(function(){ot.open(t.name,t.link)})),c,!0)}},r)).renderItems(),n.addEventListener("click",lt),o.addEventListener("click",pt),e.addEventListener("click",ft)})).catch((function(t){return console.log("Error ".concat(t))}))})();